name: AndroidBuild
on:
  pull_request:
    branches: [ main ]
  push:
    branches: [ develop ]

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4.1.0

      - name: Setup Java JDK
        uses: actions/setup-java@v3.13.0
        with:
          java-version: '17'
          distribution: 'adopt'

      - name: chmod
        run: chmod +x gradlew

      - name: Build with Gradle
        run: ./gradlew build

      - name: Upload a Build Artifact
        uses: actions/upload-artifact@v3.1.3
        with:
          name: Budle.apk
          path: app/build/outputs/apk/debug/app-debug.apk

      - name: Build Android Test APK
        run: ./gradlew assembleAndroidTest

      - name: Run Android tests on Firebase Test Lab
        uses: asadmansr/Firebase-Test-Lab-Action@v1.0
        with:
          arg-spec: 'android-device.yml:android-pixel-4'
        env:
          SERVICE_ACCOUNT: '{
  "type": "service_account",
  "project_id": "budle-5d393",
  "private_key_id": "2bf6161419ab81e6996e859b6d033a64924f8011",
  "private_key": "-----BEGIN PRIVATE KEY-----\nMIIEvQIBADANBgkqhkiG9w0BAQEFAASCBKcwggSjAgEAAoIBAQCrn8N7HIjmIEol\nNP5AFKu0xGdZnt02Tq71pmaxzJBjf4lSHpqcpuczBElXSzakTFyMVMTSflTaae+V\nHu2PI/deD/UCOFloceg+t8E8Dxh5Us3hgO8j21d7vz8A7XvFKqXpk7+3kPmi+tsz\ntkuZKjjyHVAro6sr69M+LN8S6V4LhJy4jhe73EMmMyQDerq8mNMiaCRNjWHHgcAG\nOkwkDj5BV6J+vgPh2i4XcViVoh+6t6N6TwIOQogb5b2oq939UFvq33+PCRvAzo3u\nX7hZ3McQIg47V+EVuXMWeKLehMHSK6jBTa0kjGyeb+E/rpVej/B3ci+/+iP+1mva\nBkYB4MOXAgMBAAECggEAUI+8t7AT1Q5oL6H6DUOGvGKLbwbDKUhzGW2kfCadyo7l\n+23RPuKb2ZdUBA2S1znfIaJzB6n0k9gxdergMZZ8+iL8bC/eTEhX8ATayKH/Z4gG\ni6m117uRC84guYNA27Mi0Yug7X64qBggSFx0jS/ELmazKOD5qzLWZLO0fRCdrEKr\nd8/HIVX2ZxOeWatyC9U3Hr69bR5o1tLtC4yjSMyDhRFH75oNXtQE2ezbQFX+l+SN\n34i+63dqio8UCo9YDEzt4OAkPpKYljk7lntM5pSn8LvsKV30j4SjAuVpGdhJrmzf\nMdwfbX8ved0leD+XDUb328oq5GRXxl/RGziN6/R49QKBgQDxiv8CNxxile7Z6NCn\n25cK+2s2dtn/i7d0a89TGZGTV3hcQ4PN23OJ6Wbz5iRUnHxdMyxasKGFY4xFhn1t\nsC3/AqJI9vd593+BYSQMTreTYY95aMJdvv9UPMTmYI+h8aOV1Z022uH9H2l8OqdW\nZZMAfOd37GSjNw2CYzZ/rCAeMwKBgQC15XJM4HCTM7GJDvY34e7BSH7ym6xU4TMa\nKCDQAxhPrfidCeBkgprrgzwiRydbqyOdOH8sU2DPT0453Ln+jHYfOr9C7c6gItNA\nOxvQYFyXBodBrwmdrCvK6jEgHIAoFrNB8Z2i5goKw2930aNY8f1MW7Q9uEEKxl1/\nYGNLOMLZDQKBgQDo2yL0M8T9laVqFfPxntSCFddJ7lJC9aKqbbS1XBTngo/aAoxy\nTHmaHpTN1LR5jVKnVsoPs/BC87Eq5XjN4ea1zQg+Zzg1MNCPHeLuqoR3ZLo4RTH7\nxkHIJ716iuRtLtKRhBnH5EOxDjNXPAROWiXZdpB/IDn0zwILDTJg6sMb2QKBgEQ3\n6FVCu5XJhmTz0o4E0yl0SgAtOEWhLCw8Loo1DvIbOimTYa/wd6+qSWxFqVIs7i9x\n1+hE4QL/KER1LuBzx31Q6Bhu3dabGQV25aiR60fM7/9HaWDUCJySlpgHeF0Qnmw1\n9Lv6cHu27mBOpGegYjI4FnIrX2FuIfS6rqKwiAslAoGACl5hPnec6DHLNxnissBl\nmq2ARS7HZKqF8c6v0V7CLox0sDXZgt8fdVv+QlFIRTpk/vkUEGxWWavSwQKW9IWV\nrEDfAamhvLOPJe3OHXJkZ67OFNwXNUv+6ANr6Ou+4cIhG8n0ee+lx8dOKw1sxn2L\nqTSoFzGwWvv17cmiXdOn3Zs=\n-----END PRIVATE KEY-----\n",
  "client_email": "firebase-adminsdk-4glpr@budle-5d393.iam.gserviceaccount.com",
  "client_id": "109811266270670294443",
  "auth_uri": "https://accounts.google.com/o/oauth2/auth",
  "token_uri": "https://oauth2.googleapis.com/token",
  "auth_provider_x509_cert_url": "https://www.googleapis.com/oauth2/v1/certs",
  "client_x509_cert_url": "https://www.googleapis.com/robot/v1/metadata/x509/firebase-adminsdk-4glpr%40budle-5d393.iam.gserviceaccount.com",
  "universe_domain": "googleapis.com"
}'
